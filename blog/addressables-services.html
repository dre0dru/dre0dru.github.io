<!DOCTYPE html><html lang="en"><head><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/index.xml"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" media="print"/><noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap"/></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous"/><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if(!e)return localStorage.setItem('theme','light'),d.add('light');if("system"===e){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/Dre0Dru"/><meta name="twitter:creator" content="https://twitter.com/Dre0Dru"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="600"/><meta property="og:locale" content="en-us"/><meta name="author" content="Andrey Skobelev"/><title>Addressables Services for the async/await workflow with UniTask – Dre0Dru personal blog</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Unity has great asset management system in a form of Addressables, but to properly leverage all its functionality there is a need for a robust wrapper that carefully handles all operations with proper exceptions reporting and resources cleanup. Here is my reasoning behind creating that kind of wrapper."/><meta property="og:url" content="https://dre0dru.github.io/blog/addressables-services"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2021-04-03T00:00:00.000Z"/><meta property="article:modified_time" content="2021-04-03T00:00:00.000Z"/><meta property="article:author" content="https://dre0dru.github.io/about"/><meta property="article:tag" content="Unity"/><meta property="article:tag" content="Addressables"/><meta property="article:tag" content="UniTask"/><meta property="og:title" content="Addressables Services for the async/await workflow with UniTask"/><meta property="og:description" content="Unity has great asset management system in a form of Addressables, but to properly leverage all its functionality there is a need for a robust wrapper that carefully handles all operations with proper exceptions reporting and resources cleanup. Here is my reasoning behind creating that kind of wrapper."/><meta property="og:image" content="https://dre0dru.github.io/static/images/social-banner-large.png"/><meta property="og:image:alt" content="Addressables Services for the async/await workflow with UniTask"/><link rel="canonical" href="https://dre0dru.github.io/blog/addressables-services"/><meta name="twitter:image" content="https://dre0dru.github.io/static/images/social-banner-large.png"/><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://dre0dru.github.io/blog/addressables-services"
    },
    "headline": "Addressables Services for the async/await workflow with UniTask",
    "image": [
      "[object Object]"
     ],
    "datePublished": "2021-04-03T00:00:00.000Z",
    "dateModified": "2021-04-03T00:00:00.000Z",
    "author": {"@type": "Person","name": "Andrey Skobelev"},
    "publisher": {
      "@type": "Organization",
      "name": "Andrey Skobelev",
      "logo": {
        "@type": "ImageObject",
        "url": "undefined"
      }
    },
    "description": "Unity has great asset management system in a form of Addressables, but to properly leverage all its functionality there is a need for a robust wrapper that carefully handles all operations with proper exceptions reporting and resources cleanup. Here is my reasoning behind creating that kind of wrapper."
  }</script><meta name="next-head-count" content="29"/><link rel="preload" href="/_next/static/css/a10877cabca09658951d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a10877cabca09658951d.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-7f60ff50b9a57cb62a00.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.3001023d071dd3bbe4b7.js" as="script"/><link rel="preload" href="/_next/static/chunks/26ad184ddc2343b861b9bcedad5ceb01b11d41f7.e38c07bc49befff6c8be.js" as="script"/><link rel="preload" href="/_next/static/chunks/a438ddfc9656e71378afc75153a3af52615c85dc.2943b8201ebfd4bc8d6f.js" as="script"/><link rel="preload" href="/_next/static/chunks/c9787b2e67d04485ea556b79e503c7f6cc1ff4d5.602a5e1686181f75798c.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-3e550c63368c9b9cdad9.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5Bslug%5D-64d0e6170af7d7af94eb.js" as="script"/></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex flex-col justify-between h-screen"><header class="flex items-center justify-between py-10"><div><a aria-label="Tailwind CSS Blog" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="49" height="55" viewBox="0 0 117.317 131.54"><path d="M51.858 0L0 29.94v67.734l58.659 33.866 58.658-33.866V29.94L104 22.252v67.733L58.66 116.162 13.318 89.985V37.629l38.54-22.251z" fill="#009dac"></path><path d="M69.793 2.503v39.132l-11.135-6.428-24.768 14.3v28.6l24.768 14.3 24.77-14.3V10.374zM58.658 50.951l11.135 6.428v12.856l-11.135 6.428-11.133-6.428V57.379z" fill="#009dac"></path><path d="M13.318 89.985v15.377l45.341 26.178 58.658-33.866V82.3l-58.658 33.861z" fill="#066875"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Dre0Dru</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/projects">Projects</a><a class="p-1 font-medium text-gray-900 sm:p-4 dark:text-gray-100" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="w-8 h-8 ml-1 mr-1 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed w-full h-full top-24 right-0 bg-gray-200 dark:bg-gray-800 opacity-95 z-10 transform ease-in-out duration-300 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed w-full h-full cursor-auto focus:outline-none"></button><nav class="fixed h-full mt-8"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/projects">Projects</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2021-04-03">Saturday, April 3, 2021</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Addressables Services for the async/await workflow with UniTask</h1></div></div></header><div class="pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:pt-11 xl:border-b xl:border-gray-200 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 xl:block sm:space-x-12 xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/avatar.jpg" alt="avatar" class="w-10 h-10 rounded-full"/><dl class="text-sm font-medium leading-5 whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Andrey Skobelev</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/Dre0Dru" class="text-blue-500 hover:text-blue-600 dark:hover:text-blue-400">@Twitter</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-3 xl:row-span-2"><div class="pt-10 pb-8 prose dark:prose-dark max-w-none"><div><p>Unity has great asset management system in a form of <code>Addressables</code>, but to properly leverage all its functionality there is a need for a robust wrapper that carefully handles all operations with proper exceptions reporting and resources cleanup. Here is my reasoning behind creating that kind of wrapper.</p><h1 id="why"><a href="#why" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Why?</h1><p>There are a lot of things to take care of when working with <code>Addressables</code>:</p><ul><li>Checking <code>AsyncOperationHandle</code> statuses.</li><li>Releasing <code>AsyncOperationHandle</code> on operation success/failure.</li><li>Working with morally deprecated (IMHO) Event-based Asynchronous Pattern that can potentially lead to callback hell.</li><li>Working with coroutines by yielding <code>AsyncOperationHandle</code> without ability to return values from it or use <code>try catch</code> blocks.</li><li>Working with modern and shiny Task-based Asynchronous Pattern that has its own share of problems when working with <code>Addressables</code>:<ul><li><code>try catch</code> blocks around <code>AsyncOperationHandle.Task</code> does not catch exceptions, you still have to manually check <code>AsyncOperationHandle.Status</code> and throw <code>AsyncOperationHandle.OperationException</code>:</li></ul><pre><code>try
{
    var asyncOp = Addressables.LoadAssetAsync&lt;Sprite&gt;(InvalidSpriteAssetReference);
    Sprite result = await asyncOp.Task;
}
//If any error occurs during async operation it won&#x27;t be caught by catch block
catch (Exception e)
{
    Debug.LogError($&quot;Error during asset loading: {e}&quot;);
}
</code></pre><ul><li>When <code>Addressables</code> profiler events sending is enabled there always will be <code>UnityException</code> when awaiting <code>AsyncOperationHandle.Task</code> (Unity still can&#x27;t fix it :( ).</li></ul></li><li>No compile-time type safety when using some of the <code>Addressables</code> API. For example, <code>Addressables.LoadAssetAsync&lt;Sprite&gt;(AssetKey)</code> expects <code>object</code> or <code>IResourceLocation</code> as its argument, but there is absolutely no guarantee that there will <code>Sprite</code> by that asset key.</li><li>Managing resources reference counts. It seems like pretty easy task, but ensuring that all unused assets are unloaded automatically by relying on <code>Addressables</code> reference-counting can become daunting work when assets are loaded from here and there during application lifecycle.</li></ul><h1 id="how"><a href="#how" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>How?</h1><p>I wanted to create a wrapper for most common <code>Addressables</code> operations that solves aforementioned problems. Here are my main goals:</p><ul><li><code>async/await</code> workflow with proper structured exception handling.<ul><li>This was achieved by using <a target="_blank" rel="noopener noreferrer" href="https://github.com/Cysharp/UniTask">UniTask</a> package. There is a way to solve this without reliance on the <code>UniTask</code>, but I don&#x27;t feel like reinventing the wheel, because <code>UniTask</code> does exactly what I need. Also, with some performance benefits because of the reduced memory allocation for tasks.</li></ul></li><li>Compile-time type safety using <code>AssetReference&lt;T&gt;</code> for the asset loading operations.<ul><li>Providing generic <code>IAddressablesLoader&lt;T&gt;</code> that accepts <code>AssetReference&lt;T&gt;</code> only of the same type constraint as its arguments.</li></ul></li><li>Ensuring resources are properly loaded and unloaded after they are not needed by separating resources management in two phases:<ul><li>Preload phase: preload and hold all required resources in <code>IAddressablesLoader&lt;T&gt;</code> instance. Use them in sync way during gameplay. It is also possible to load necessary resources whenever you need, but it is better to cleanly define an entry point where everything is prepared beforehand.</li><li>Unload phase: release and loaded or individual resources from <code>IAddressablesLoader&lt;T&gt;</code>, e.g. when switching to another <code>Scene</code> with different set of required assets.</li><li>No need to worry about ref-counts since all references are concentrated in one place and it is impossible to load something twice or use asset that was not preloaded before.</li></ul></li><li>Project independence. Package can be used in almost every project, it has a small codebase with the possibility to extend it further when needs arise.</li></ul><h2 id="result"><a href="#result" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Result</h2><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/dre0dru/AddressablesServices">Addressables Services</a> is the open-source Unity package that provides essential functionality for the worry-free usage of <code>Addressables</code> in safe and predictable manner.</p><p>You can read more about usage and installation on <a target="_blank" rel="noopener noreferrer" href="https://github.com/dre0dru/AddressablesServices">GitHub</a>.</p></div></div></div><footer><div class="text-sm font-medium leading-5 divide-gray-200 xl:divide-y dark:divide-gray-700 xl:col-start-1 xl:row-start-2"><div class="py-4 xl:py-8"><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium text-blue-500 uppercase hover:text-blue-600 dark:hover:text-blue-400" href="/tags/unity">Unity</a><a class="mr-3 text-sm font-medium text-blue-500 uppercase hover:text-blue-600 dark:hover:text-blue-400" href="/tags/addressables">Addressables</a><a class="mr-3 text-sm font-medium text-blue-500 uppercase hover:text-blue-600 dark:hover:text-blue-400" href="/tags/uni-task">UniTask</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Previous Article</h2><div class="text-blue-500 hover:text-blue-600 dark:hover:text-blue-400"><a href="/blog/tu-144">Tu-144</a></div></div><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Next Article</h2><div class="text-blue-500 hover:text-blue-600 dark:hover:text-blue-400"><a href="/blog/local-storage">Local Storage - a set of utility classes for managing local data stored on device</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-blue-500 hover:text-blue-600 dark:hover:text-blue-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/dre0dru"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dre0dru"><span class="sr-only">linkedin</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/Dre0Dru"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 dark:text-gray-200 hover:text-blue-500 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></a></div><div class="flex mb-8 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Andrey Skobelev</div><div> • </div><div>© 2021</div><div> • </div><a href="/">Dre0Dru personal blog</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i \u003c arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i \u003c sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i \u003c sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Unity has great asset management system in a form of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Addressables\"), \", but to properly leverage all its functionality there is a need for a robust wrapper that carefully handles all operations with proper exceptions reporting and resources cleanup. Here is my reasoning behind creating that kind of wrapper.\"), mdx(\"h1\", {\n    \"id\": \"why\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h1\"\n  }, {\n    \"href\": \"#why\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"Why?\"), mdx(\"p\", null, \"There are a lot of things to take care of when working with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Addressables\"), \":\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Checking \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"AsyncOperationHandle\"), \" statuses.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Releasing \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"AsyncOperationHandle\"), \" on operation success/failure.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Working with morally deprecated (IMHO) Event-based Asynchronous Pattern that can potentially lead to callback hell.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Working with coroutines by yielding \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"AsyncOperationHandle\"), \" without ability to return values from it or use \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"try catch\"), \" blocks.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Working with modern and shiny Task-based Asynchronous Pattern that has its own share of problems when working with \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Addressables\"), \":\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"try catch\"), \" blocks around \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"AsyncOperationHandle.Task\"), \" does not catch exceptions, you still have to manually check \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"AsyncOperationHandle.Status\"), \" and throw \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"AsyncOperationHandle.OperationException\"), \":\")), mdx(\"pre\", {\n    parentName: \"li\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"try\\n{\\n    var asyncOp = Addressables.LoadAssetAsync\u003cSprite\u003e(InvalidSpriteAssetReference);\\n    Sprite result = await asyncOp.Task;\\n}\\n//If any error occurs during async operation it won't be caught by catch block\\ncatch (Exception e)\\n{\\n    Debug.LogError($\\\"Error during asset loading: {e}\\\");\\n}\\n\")), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"When \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Addressables\"), \" profiler events sending is enabled there always will be \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"UnityException\"), \" when awaiting \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"AsyncOperationHandle.Task\"), \" (Unity still can't fix it :( ).\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"No compile-time type safety when using some of the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Addressables\"), \" API. For example, \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Addressables.LoadAssetAsync\u003cSprite\u003e(AssetKey)\"), \" expects \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"object\"), \" or \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"IResourceLocation\"), \" as its argument, but there is absolutely no guarantee that there will \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Sprite\"), \" by that asset key.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Managing resources reference counts. It seems like pretty easy task, but ensuring that all unused assets are unloaded automatically by relying on \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Addressables\"), \" reference-counting can become daunting work when assets are loaded from here and there during application lifecycle.\")), mdx(\"h1\", {\n    \"id\": \"how\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h1\"\n  }, {\n    \"href\": \"#how\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"How?\"), mdx(\"p\", null, \"I wanted to create a wrapper for most common \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Addressables\"), \" operations that solves aforementioned problems. Here are my main goals:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"async/await\"), \" workflow with proper structured exception handling.\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"This was achieved by using \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/Cysharp/UniTask\"\n  }), \"UniTask\"), \" package. There is a way to solve this without reliance on the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"UniTask\"), \", but I don't feel like reinventing the wheel, because \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"UniTask\"), \" does exactly what I need. Also, with some performance benefits because of the reduced memory allocation for tasks.\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Compile-time type safety using \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"AssetReference\u003cT\u003e\"), \" for the asset loading operations.\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Providing generic \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"IAddressablesLoader\u003cT\u003e\"), \" that accepts \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"AssetReference\u003cT\u003e\"), \" only of the same type constraint as its arguments.\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Ensuring resources are properly loaded and unloaded after they are not needed by separating resources management in two phases:\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Preload phase: preload and hold all required resources in \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"IAddressablesLoader\u003cT\u003e\"), \" instance. Use them in sync way during gameplay. It is also possible to load necessary resources whenever you need, but it is better to cleanly define an entry point where everything is prepared beforehand.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Unload phase: release and loaded or individual resources from \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"IAddressablesLoader\u003cT\u003e\"), \", e.g. when switching to another \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Scene\"), \" with different set of required assets.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"No need to worry about ref-counts since all references are concentrated in one place and it is impossible to load something twice or use asset that was not preloaded before.\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Project independence. Package can be used in almost every project, it has a small codebase with the possibility to extend it further when needs arise.\")), mdx(\"h2\", {\n    \"id\": \"result\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#result\",\n    \"aria-hidden\": \"true\",\n    \"tabIndex\": -1\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"icon icon-link\"\n  }))), \"Result\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/dre0dru/AddressablesServices\"\n  }), \"Addressables Services\"), \" is the open-source Unity package that provides essential functionality for the worry-free usage of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Addressables\"), \" in safe and predictable manner.\"), mdx(\"p\", null, \"You can read more about usage and installation on \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/dre0dru/AddressablesServices\"\n  }), \"GitHub\"), \".\"));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"\u003cp\u003eUnity has great asset management system in a form of \u003ccode\u003eAddressables\u003c/code\u003e, but to properly leverage all its functionality there is a need for a robust wrapper that carefully handles all operations with proper exceptions reporting and resources cleanup. Here is my reasoning behind creating that kind of wrapper.\u003c/p\u003e\u003ch1 id=\"why\"\u003e\u003ca href=\"#why\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eWhy?\u003c/h1\u003e\u003cp\u003eThere are a lot of things to take care of when working with \u003ccode\u003eAddressables\u003c/code\u003e:\u003c/p\u003e\u003cul\u003e\u003cli\u003eChecking \u003ccode\u003eAsyncOperationHandle\u003c/code\u003e statuses.\u003c/li\u003e\u003cli\u003eReleasing \u003ccode\u003eAsyncOperationHandle\u003c/code\u003e on operation success/failure.\u003c/li\u003e\u003cli\u003eWorking with morally deprecated (IMHO) Event-based Asynchronous Pattern that can potentially lead to callback hell.\u003c/li\u003e\u003cli\u003eWorking with coroutines by yielding \u003ccode\u003eAsyncOperationHandle\u003c/code\u003e without ability to return values from it or use \u003ccode\u003etry catch\u003c/code\u003e blocks.\u003c/li\u003e\u003cli\u003eWorking with modern and shiny Task-based Asynchronous Pattern that has its own share of problems when working with \u003ccode\u003eAddressables\u003c/code\u003e:\u003cul\u003e\u003cli\u003e\u003ccode\u003etry catch\u003c/code\u003e blocks around \u003ccode\u003eAsyncOperationHandle.Task\u003c/code\u003e does not catch exceptions, you still have to manually check \u003ccode\u003eAsyncOperationHandle.Status\u003c/code\u003e and throw \u003ccode\u003eAsyncOperationHandle.OperationException\u003c/code\u003e:\u003c/li\u003e\u003c/ul\u003e\u003cpre\u003e\u003ccode\u003etry\n{\n    var asyncOp = Addressables.LoadAssetAsync\u0026lt;Sprite\u0026gt;(InvalidSpriteAssetReference);\n    Sprite result = await asyncOp.Task;\n}\n//If any error occurs during async operation it won\u0026#x27;t be caught by catch block\ncatch (Exception e)\n{\n    Debug.LogError($\u0026quot;Error during asset loading: {e}\u0026quot;);\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\u003cli\u003eWhen \u003ccode\u003eAddressables\u003c/code\u003e profiler events sending is enabled there always will be \u003ccode\u003eUnityException\u003c/code\u003e when awaiting \u003ccode\u003eAsyncOperationHandle.Task\u003c/code\u003e (Unity still can\u0026#x27;t fix it :( ).\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003cli\u003eNo compile-time type safety when using some of the \u003ccode\u003eAddressables\u003c/code\u003e API. For example, \u003ccode\u003eAddressables.LoadAssetAsync\u0026lt;Sprite\u0026gt;(AssetKey)\u003c/code\u003e expects \u003ccode\u003eobject\u003c/code\u003e or \u003ccode\u003eIResourceLocation\u003c/code\u003e as its argument, but there is absolutely no guarantee that there will \u003ccode\u003eSprite\u003c/code\u003e by that asset key.\u003c/li\u003e\u003cli\u003eManaging resources reference counts. It seems like pretty easy task, but ensuring that all unused assets are unloaded automatically by relying on \u003ccode\u003eAddressables\u003c/code\u003e reference-counting can become daunting work when assets are loaded from here and there during application lifecycle.\u003c/li\u003e\u003c/ul\u003e\u003ch1 id=\"how\"\u003e\u003ca href=\"#how\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eHow?\u003c/h1\u003e\u003cp\u003eI wanted to create a wrapper for most common \u003ccode\u003eAddressables\u003c/code\u003e operations that solves aforementioned problems. Here are my main goals:\u003c/p\u003e\u003cul\u003e\u003cli\u003e\u003ccode\u003easync/await\u003c/code\u003e workflow with proper structured exception handling.\u003cul\u003e\u003cli\u003eThis was achieved by using \u003ca target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/Cysharp/UniTask\"\u003eUniTask\u003c/a\u003e package. There is a way to solve this without reliance on the \u003ccode\u003eUniTask\u003c/code\u003e, but I don\u0026#x27;t feel like reinventing the wheel, because \u003ccode\u003eUniTask\u003c/code\u003e does exactly what I need. Also, with some performance benefits because of the reduced memory allocation for tasks.\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003cli\u003eCompile-time type safety using \u003ccode\u003eAssetReference\u0026lt;T\u0026gt;\u003c/code\u003e for the asset loading operations.\u003cul\u003e\u003cli\u003eProviding generic \u003ccode\u003eIAddressablesLoader\u0026lt;T\u0026gt;\u003c/code\u003e that accepts \u003ccode\u003eAssetReference\u0026lt;T\u0026gt;\u003c/code\u003e only of the same type constraint as its arguments.\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003cli\u003eEnsuring resources are properly loaded and unloaded after they are not needed by separating resources management in two phases:\u003cul\u003e\u003cli\u003ePreload phase: preload and hold all required resources in \u003ccode\u003eIAddressablesLoader\u0026lt;T\u0026gt;\u003c/code\u003e instance. Use them in sync way during gameplay. It is also possible to load necessary resources whenever you need, but it is better to cleanly define an entry point where everything is prepared beforehand.\u003c/li\u003e\u003cli\u003eUnload phase: release and loaded or individual resources from \u003ccode\u003eIAddressablesLoader\u0026lt;T\u0026gt;\u003c/code\u003e, e.g. when switching to another \u003ccode\u003eScene\u003c/code\u003e with different set of required assets.\u003c/li\u003e\u003cli\u003eNo need to worry about ref-counts since all references are concentrated in one place and it is impossible to load something twice or use asset that was not preloaded before.\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003cli\u003eProject independence. Package can be used in almost every project, it has a small codebase with the possibility to extend it further when needs arise.\u003c/li\u003e\u003c/ul\u003e\u003ch2 id=\"result\"\u003e\u003ca href=\"#result\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eResult\u003c/h2\u003e\u003cp\u003e\u003ca target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/dre0dru/AddressablesServices\"\u003eAddressables Services\u003c/a\u003e is the open-source Unity package that provides essential functionality for the worry-free usage of \u003ccode\u003eAddressables\u003c/code\u003e in safe and predictable manner.\u003c/p\u003e\u003cp\u003eYou can read more about usage and installation on \u003ca target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/dre0dru/AddressablesServices\"\u003eGitHub\u003c/a\u003e.\u003c/p\u003e","scope":{}},"frontMatter":{"wordCount":572,"readingTime":{"text":"3 min read","minutes":2.85,"time":171000,"words":570},"slug":"addressables-services","fileName":"addressables-services.md","title":"Addressables Services for the async/await workflow with UniTask","date":"2021-04-03","tags":["Unity","Addressables","UniTask"],"draft":false,"summary":"Unity has great asset management system in a form of Addressables, but to properly leverage all its functionality there is a need for a robust wrapper that carefully handles all operations with proper exceptions reporting and resources cleanup. Here is my reasoning behind creating that kind of wrapper.","images":[]}},"prev":{"title":"Tu-144","date":"2021-03-30","tags":["portfolio"],"draft":false,"summary":"An interactive museum inside legendary supersonic aircraft.","images":[],"slug":"tu-144"},"next":{"title":"Local Storage - a set of utility classes for managing local data stored on device","date":"2021-05-08","tags":["Unity","Data Management"],"draft":false,"summary":"Sometimes there is a need arises for saving data locally on a device, be it server data caching, managing game progress for offline games, or storing user preferences. First, you write necessary data in plain text, then you switch to JSON for readability, after that you want to protect your files from curious users. Next time you notice that your data takes too much space on a device, so you want to compress your data. The improvement process can go indefinitely, so here is my take on solving that kind of problems.","images":[],"slug":"local-storage"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"addressables-services"},"buildId":"eFiHbgsqUXeKHrlaGLoGT","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-040103c5c51c5268569e.js"></script><script src="/_next/static/chunks/main-7f60ff50b9a57cb62a00.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/commons.3001023d071dd3bbe4b7.js" async=""></script><script src="/_next/static/chunks/26ad184ddc2343b861b9bcedad5ceb01b11d41f7.e38c07bc49befff6c8be.js" async=""></script><script src="/_next/static/chunks/a438ddfc9656e71378afc75153a3af52615c85dc.2943b8201ebfd4bc8d6f.js" async=""></script><script src="/_next/static/chunks/c9787b2e67d04485ea556b79e503c7f6cc1ff4d5.602a5e1686181f75798c.js" async=""></script><script src="/_next/static/chunks/pages/_app-3e550c63368c9b9cdad9.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-64d0e6170af7d7af94eb.js" async=""></script><script src="/_next/static/eFiHbgsqUXeKHrlaGLoGT/_buildManifest.js" async=""></script><script src="/_next/static/eFiHbgsqUXeKHrlaGLoGT/_ssgManifest.js" async=""></script></body></html>